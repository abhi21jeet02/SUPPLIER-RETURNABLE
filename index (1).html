<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supplier Returnable Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA manifest + theme -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3498db">

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("✅ PWA Registered"))
        .catch(err => console.error("Service Worker failed", err));
    }
  </script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 20px;
      background: #f9fafc;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    label {
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 16px;
      font-weight: 600;
    }
    select, input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    input[type="number"] {
      font-size: 20px;      
      font-weight: bold;    
      text-align: center;   
      padding: 12px;        
      border: 2px solid #3498db;
      border-radius: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #2ecc71;
      box-shadow: 0 0 5px #2ecc71;
    }
    /* Color-coded backgrounds */
    #bin { background: #fffbe6; } /* light yellow */
    #trolley { background: #e6f7ff; } /* light blue */
    #ppBox { background: #eaffea; } /* light green */
    #pallets { background: #fff2e6; } /* light orange */
    #other { background: #f5f5f5; } /* light gray */

    /* Responsive for mobile */
    @media (max-width: 600px) {
      form { grid-template-columns: 1fr; }
      input[type="number"] { font-size: 22px; }
      label { font-size: 18px; }
    }

    .full-width {
      grid-column: span 2;
      text-align: center;
    }
    button {
      background: #3498db;
      color: #fff;
      border: none;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
    .danger {
      background: #e74c3c;
    }
    .danger:hover {
      background: #c0392b;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #3498db;
      color: #fff;
    }

    /* Large submit button */
    .full-width button[type="submit"] {
      font-size: 20px;
      padding: 15px;
      width: 100%;
      border-radius: 10px;
    }

    /* Single voice mic button */
    .single-voice-btn {
      margin: 10px 0;
      background: #2ecc71;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      width: 100%;
    }
    .single-voice-btn:hover {
      background: #27ae60;
    }

  </style>
</head>
<body>
  <h1>Supplier Returnable Tracker</h1>
  <div class="container">
    <form id="entryForm">
      <div>
        <label for="supplier">Supplier</label>
        <select id="supplier" required></select>
      </div>

      <div>
        <label for="trolley">Trolley</label>
        <input type="number" id="trolley" min="0">
      </div>
      <div>
        <label for="bin">Bin</label>
        <input type="number" id="bin" min="0">
      </div>
      <div>
        <label for="ppBox">PP Box</label>
        <input type="number" id="ppBox" min="0">
      </div>
      <div>
        <label for="pallets">Pallets</label>
        <input type="number" id="pallets" min="0">
      </div>
      <div>
        <label for="other">Other</label>
        <input type="number" id="other" min="0">
      </div>

      <!-- Single mic button -->
      <div class="full-width">
        <button type="button" class="single-voice-btn" onclick="startVoiceAll()">🎤 Speak Quantities</button>
      </div>

      <div class="full-width">
        <button type="submit">Add Entry</button>
        <button type="button" onclick="sendToGoogle()">Send to Google Sheet</button>
        <button type="button" onclick="downloadExcel()">Download Excel</button>
        <button type="button" class="danger" onclick="clearData()">Clear Data</button>
      </div>
    </form>

    <table id="dataTable">
      <thead>
        <tr>
          <th>S.No</th>
          <th>Supplier</th>
          <th>Trolley</th>
          <th>Bin</th>
          <th>PP Box</th>
          <th>Pallets</th>
          <th>Other</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr id="summaryRow">
          <th colspan="2">TOTAL</th>
          <th id="totalTrolley">0</th>
          <th id="totalBin">0</th>
          <th id="totalPPBox">0</th>
          <th id="totalPallets">0</th>
          <th id="totalOther">0</th>
          <th>-</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    const suppliers = [
     "A G INDUSTRIES PVT LTD",
"A.G. PREMIUM STEERINGS AND MOULDINGS PRIVATE LIMITED",
"A.J. AUTO PRIVATE LIMITED",
"ACCURA VALVES PRIVATE LIMITED",
"ACCURATE PRODUCTS CORPORATION PVT LTD",
"ACCURATE PRODUCTS CORPORATION PVT LTD",
"ACTIVE CHROMEWELL EXHAUST PRIVATE LIMITED",
"AJ AUTO PVT LTD",
"AMALGAMATIONS VALEO CLUTCH PVT. LTD.",
"ANANDJI HARIDAS AND COMPANY PRIVATE LIMITED",
"ARAYMOND INDIA PRIVATE LIMITEC-FORMERLY A RAYMOND FASTENERS INDIA PVT. LTD.",
"ASIAN WIRE FORMING & SPRINGS PVT.LIMITED",
"ASIAN WIRE FORMING AND SPRINGS PRIVATE LIMITED",
"ASP SEALING PRODUCTS LIMITED",
"ATC TIRES PRIVATE LIMITED",
"ATOP FASTENERS PRIVATE LIMITED",
"ATOP PRODUCTS PRIVATE LIMITED",
"AURANGABAD AUTO ENGINEERING PRIVATE LIMITED",
"AUTO IGNITION LIMITED",
"AUTO TECH ENGINEERS",
"B. D. INDUSTRIES(PUNE) PVT. LTD",
"BALKRISHNA INDUSTRIES LIMITED",
"BANCO PRODUCTS (INDIA) LIMITED",
"BAPL ROTOTECH PRIVATE LIMITED",
"BBL DAIDO PRIVATE LIMITED",
"BBL DAIDO PVT LTD",
"BELRISE INDUSTRIES LIMITED (Erstwhile known as Badve Engineering Limited)'",
"BELRISE INDUSTRIES LIMITED. (ERSTWHILE KNOWN AS BADVE ENGINEERING LIMITED)",
"BG LI-IN ELECTRICALS LIMITED",
"BHARAT GEARS LIMITED",
"BONY POLYMERS PRIVATE LIMITED",
"BOSCH LIMITED",
"BSL CASTING PVT LTD",
"BSL CASTING PVT LTD",
"BSL CASTINGS (P) LTD.",
"BUCHER HYDRAULICS PRIVATE LIMITED",
"CAPARO ENGG HARDWARE",
"CAPARO ENGINEERING INDIA LIMITED",
"CASTMASTER INDUSTRIES PRIVATE LIMITED",
"CCTY BEARING INDIA PVT LTD",
"CIRCLIPS TECHNOLOGIE PRIVATE LIMITED",
"CIRCLIPS TECHNOLOGIE PVT. LTD.",
"CONTITECH INDIA PRIVATE LIMITED",
"CRAFTSMEN LABELMAKERS PVT LTD.",
"DEUSCH MOTOCOMP PRIVATE LIMITED",
"DONALDSON INDIA FILTER SYSTEMS PVT LTD",
"EMDET ENGINEERS PVT LTD",
"EMDET JAMSHEDPUR PRIVATE LIMITED",
"EXIDE INDUSTRIES LIMITED",
"FIEM INDUSTRIES LTD.",
"GEE AAR GRAPHICS",
"GHATGE PATIL INDUSTRIES LTD",
"GHAZIABAD PRECISION PRODUCTS PRIVATE LIMITED",
"GRAEPEL PERFORATIONS INDIA PRIVATE LIMITED",
"GROZ ENGINEERING TOOLS PRIVATE LIMITED",
"GROZ ENGINEERING TOOLS PVT LTD",
"HAPPY STEELS PRIVATE LIMITED",
"HARITA SEATING SYSTEMS LTD",
"HARYANA INDUSTRIES",
"HILUX AUTOELECTRIC PVT.LTD.",
"HI-LUX AUTOMOTIVE PRIVATE LIMITED",
"IMAGE SYNERGY EKXPLOR PRIVATE LIMITED FORMERLY IMAGE LABELS PRIVATE LIMITED",
"INDICA INDUSTRIES PRIVATE LIMITED",
"INDICATORS MANUFACTURING COMPANY",
"INDO AUTOTECH LIMITED",
"INDUSTRIAL ENGINEERING SYNDICATE",
"JAYEM AUTO INDUSTRIES PRIVATE LIMITED",
"JBM AUTO LIMITED",
"JBM INDUSTRIES LIMITED",
"JM FRICTECH INDIA PRIVATE LIMITED",
"JM FRICTECH INDIA PVT LTD",
"KIRLOSKAR FERROUS INDUSTRIES LTD.",
"KRISHNA MARUTI LTD",
"KUBOTA",
"KUBOTA CORPORATION",
"KUBOTA ENGINE (THAILAND) CO LTD",
"KUBOTA MACHINERY TRADING CO LTD.",
"LUBOIL FILTRATION SYSTEMS PRIVATE LIMITED",
"MACUREX SENSORS PVT. LTD.",
"MD INDUSTRIES",
"MILESTONE GEARS PRIVATE LIMITED",
"MINDA INDUSTRIES LIMITED",
"MITA INDIA PRIVATE LIMITED",
"MRF LIMITED",
"MSL DRIVELINE SYSTEMS LIMITED",
"MT AUTOCRAFT",
"MVD AUTO COMPONENTS PVT LTD",
"NACHI TECHNOLOGY INDIA PRIVATE LIMITED",
"NAPINO AUTO AND ELECTRONICS LIMITED",
"NATESAN SYNCHROCONES PRIVATE LIMITED",
"NATIONAL ENGINEERING INDUSTRIES LIMITED",
"NATIONAL ENGINEERING INDUSTRIES LTD",
"NEOLITE ZKW LIGHTINGS PRIVATE LIMITED",
"NETPLAST PRIVATE LIMITED",
"NETPLAST PVT LTD",
"NEW ALLENBERRY WORKS",
"NHB BALL & ROLLER LTD",
"NRB BEARINGS LIMITED",
"NTN BEARING INDIA PRIVATE LIMITED",
"OGNIBENE INDIA PVT. LTD.",
"OMCO ENTERPRISES PVT LIMITED",
"OMCO ENTERPRISES PVT LTD",
"ORBIT BEARINGS INDIA PVT LTD",
"OSHO TOOLS PVT LTD",
"PADMAVATI CASTINGS PVT. LTD.",
"PAVNA AUTO ENGINEERING PVT. LTD.",
"POOJA AUTO INDUSTRIES",
"PRECISION INDUSTRIAL FASTENERS",
"PREMIER SEALS (I) PRIVATE LIMITED",
"PRICOL LIMITED",
"PRIMA PRIVATE LIMITED",
"PRITIKA AUTO INDUSTRIES LIMITED",
"PYN PRECISION COMPONENTS",
"QH TALBROS PRIVATE LIMITED",
"R G BRONZE MFG. COMPANY PVT. LIMITED",
"RACL GEARTECH LIMITED",
"RAMCO STEELS PRIVATE LIMITED",
"RANE (MADRAS) LIMITED",
"RELIABLE MECHATRONICS PRIVATE LIMITED",
"RELIABLE MECHATRONICS PVT LTD",
"RIKKI  PLASTIC PRIVATE LIMITED",
"RIKKI PLASTIC PRIVATE LIMITED",
"SADHU FORGING LIMITED",
"SADHU FORGING LTD",
"SAKET FABS PRIVATE LIMITED",
"SAKET FABS PVT. LTD.",
"SAN AUTOMOTIVE INDUSTRIES PVT LTD",
"SANGKAJ TECHNOLOGIES PRIVATE LIMITED - FORMERLY AURANGABAD AUTO ENGINEERING PRIVATE LIMITED",
"SCHAEFFLER INDIA LIMITED",
"SEBROS INDUSTRIES PVT. LTD.",
"SHRIRAM FOUNDRY PRIVATE LIMITED",
"SHRIRAM FOUNDRY PVT LTD",
"SIAM KUBOTA CORPORATION CO. LTD.",
"SIETZ TECHNOLOGIES INDIA PRIVATE LIMITED",
"SIETZ TECHNOLOGIES INDIA PVT. LTD.",
"SINGHAL SINTERED PRIVATE LIMITED",
"SONA BLW PRECISION FORGINGS LIMITED",
"SOUND CASTINGS PVT. LTD.",
"STERLING TOOLS LIMITED",
"SUDTRAC LINKAGES PRIVATE LIMITED",
"SUNDRAM FASTENERS LTD",
"SUPER AUTO ELECTRICALS PVT LTD",
"SUSPA PNEUMATICS INDIA PRIVATE LIMITED",
"SYNNOVA GEARS & TRANSMISSION PVT. LTD.",
"TATA AUTOCOMP SYSTEMS LIMITED",
"TEXSPIN BEARINGS LTD",
"TRELLEBORG",
"UNIFLEX PRECISION PRODUCTS PRIVATE LIMITED",
"UNIPARTS INDIA LTD",
"UNITED TYREKRAFTS PRIVATE LIMITED",
"UNIVERSAL AUTO FOUNDRY LIMITED",
"UNIVERSAL AUTO FOUNDRY LIMITED",
"VICTORA AUTO PRIVATE LIMITED",
"VICTURA TECHNOLOGIES PRIVATE LIMITED FORMERLY VICTORA AUTO PRIVATE LIMITED",
"VISHWAS INDUSTRIAL AUTOTECH PRIVATE LIMITED",
"VISHWAS INDUSTRIAL AUTOTECH PVT. LTD.",
"VI-SON CABLES PVT. LTD.",
"WHEELS INDIA LIMITED",
"WIPRO ENTERPRISES PRIVATE LIMITED",
"YAMAN INDUSTRIES",
"YAZAKI INDIA PRIVATE LIMITED",
"YOGESH ENGINEERING WORKS",
"ZF RANA"

    ];

    const supplierSelect = document.getElementById("supplier");
    suppliers.forEach(s => {
      let option = document.createElement("option");
      option.value = s;
      option.textContent = s;
      supplierSelect.appendChild(option);
    });

    let data = JSON.parse(localStorage.getItem("returnableData")) || [];
    renderTable();

    // Smart single microphone for all fields
    function startVoiceAll() {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Your browser does not support Speech Recognition");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.start();

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase();
        console.log("Spoken:", transcript);

        // Match all numbers with keywords
        const regex = /(\d+)\s*(trolley|bin|pp box|pallets?|other)/g;
        let match;
        while ((match = regex.exec(transcript)) !== null) {
          const value = parseInt(match[1]);
          const field = match[2].replace(' ', '').toLowerCase();
          if (field === 'trolley') document.getElementById('trolley').value = value;
          else if (field === 'bin') document.getElementById('bin').value = value;
          else if (field === 'ppbox') document.getElementById('ppBox').value = value;
          else if (field === 'pallet' || field === 'pallets') document.getElementById('pallets').value = value;
          else if (field === 'other') document.getElementById('other').value = value;
        }
      };

      recognition.onerror = function(event) {
        console.error("Speech recognition error:", event.error);
      };
    }

    document.getElementById("entryForm").addEventListener("submit", function(e){
      e.preventDefault();
      const supplier = document.getElementById("supplier").value;
      const trolley = +(document.getElementById("trolley").value || 0);
      const bin = +(document.getElementById("bin").value || 0);
      const ppBox = +(document.getElementById("ppBox").value || 0);
      const pallets = +(document.getElementById("pallets").value || 0);
      const other = +(document.getElementById("other").value || 0);

      let existing = data.find(d => d.supplier === supplier);
      if(existing){
        existing.trolley += trolley;
        existing.bin += bin;
        existing.ppBox += ppBox;
        existing.pallets += pallets;
        existing.other += other;
      } else {
        data.push({supplier, trolley, bin, ppBox, pallets, other});
      }
      renderTable();
      this.reset();
    });

    function renderTable(){
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      let totals = {trolley:0, bin:0, ppBox:0, pallets:0, other:0};

      data.forEach((row, index) => {
        totals.trolley += row.trolley;
        totals.bin += row.bin;
        totals.ppBox += row.ppBox;
        totals.pallets += row.pallets;
        totals.other += row.other;

        let tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index+1}</td>
          <td>${row.supplier}</td>
          <td>${row.trolley}</td>
          <td>${row.bin}</td>
          <td>${row.ppBox}</td>
          <td>${row.pallets}</td>
          <td>${row.other}</td>
          <td>
            <button onclick="editRow(${index})">✏️</button>
            <button class="danger" onclick="deleteRow(${index})">🗑️</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("totalTrolley").textContent = totals.trolley;
      document.getElementById("totalBin").textContent = totals.bin;
      document.getElementById("totalPPBox").textContent = totals.ppBox;
      document.getElementById("totalPallets").textContent = totals.pallets;
      document.getElementById("totalOther").textContent = totals.other;

      localStorage.setItem("returnableData", JSON.stringify(data));
    }

    function editRow(index){
      const row = data[index];
      document.getElementById("supplier").value = row.supplier;
      document.getElementById("trolley").value = row.trolley;
      document.getElementById("bin").value = row.bin;
      document.getElementById("ppBox").value = row.ppBox;
      document.getElementById("pallets").value = row.pallets;
      document.getElementById("other").value = row.other;
      data.splice(index,1);
      renderTable();
    }

    function deleteRow(index){
      if(confirm("Delete this entry?")){
        data.splice(index,1);
        renderTable();
      }
    }

    function sendToGoogle(){
      alert("Data would be sent to Google Sheet:\n" + JSON.stringify(data, null, 2));
    }

    function clearData(){
      if(confirm("Are you sure you want to clear all today's data?")){
        data = [];
        localStorage.removeItem("returnableData");
        renderTable();
      }
    }

    function downloadExcel() {
      if(data.length === 0){
        alert("No data to download!");
        return;
      }
      const wb = XLSX.utils.book_new();
      const ws_data = [
        ["S.No","Supplier","Trolley","Bin","PP Box","Pallets","Other"]
      ];
      data.forEach((row,index) => {
        ws_data.push([
          index+1,
          row.supplier,
          row.trolley,
          row.bin,
          row.ppBox,
          row.pallets,
          row.other
        ]);
      });
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "Returnables");
      XLSX.writeFile(wb, "Supplier_Returnables.xlsx");
    }
  </script>
</body>